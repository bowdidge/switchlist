#!/bin/csh
#
# Build the SwitchList.app distribution and put everything in a single 
# Disk Image.
#
# Get the version by searching the CVS log for a file for the tag names. 
# Pick the first tag name, and grab the name portion.
#
# TODO(bowdidge) Redo for SVN

if $#argv != 1 then
  echo Usage: makeDistribution SwitchList-x-y-z
  exit 1
endif

set DMG_NAME=$1

echo Disk Image name is $DMG_NAME
rm -rf /tmp/SwitchList /tmp/$DMG_NAME.dmg
rm -f /tmp/SwitchList.tar.gz /tmp/SwitchList.tar
mkdir /tmp/SwitchList

rm -rf /tmp/switchlist-read-only
# TODO: Get specific version.
svn checkout http://switchlist.googlecode.com/svn/trunk/ /tmp/switchlist-read-only

pushd /tmp/switchlist-read-only/src
# Fat x86/ppc binary.
xcodebuild -target SwitchList -configuration Release  clean
xcodebuild -target SwitchList -configuration Release 
if $status != 0 then
  echo Problems building SwitchList
  exit 1
endif
popd 

mkdir /tmp/SwitchList

cp -r /XcodeCache/SharedProducts/Release/SwitchList.app /tmp/SwitchList
cp -r examples /tmp/SwitchList/Examples

pushd /tmp/
hdiutil create ./$DMG_NAME.dmg -srcfolder SwitchList/ -ov
popd

echo "/tmp/SwitchList.dmg has the final disk image."
